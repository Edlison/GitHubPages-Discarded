# 买卖股票的最佳时机

给定一个数组，它的第 i 个元素是一支给定的股票在第 i 天的价格。

设计一个算法来计算你所能获取的最大利润。你最多可以完成 两笔 交易。

注意: 你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。

**示例 1:**

输入: [3,3,5,0,0,3,1,4]  
输出: 6  
解释: 在第 4 天（股票价格 = 0）的时候买入，在第 6 天（股票价格 = 3）的时候卖出，这笔交易所能获得利润 = 3-0 = 3 。  
     随后，在第 7 天（股票价格 = 1）的时候买入，在第 8 天 （股票价格 = 4）的时候卖出，这笔交易所能获得利润 = 4-1 = 3 。

**示例 2:**

输入: [1,2,3,4,5]  
输出: 4  
解释: 在第 1 天（股票价格 = 1）的时候买入，在第 5 天 （股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5-1 = 4 。     
     注意你不能在第 1 天和第 2 天接连购买股票，之后再将它们卖出。   
     因为这样属于同时参与了多笔交易，你必须在再次购买前出售掉之前的股票。

**示例 3:**

输入: [7,6,4,3,1]  
输出: 0  
解释: 在这个情况下, 没有交易完成, 所以最大利润为 0。 

动态规划  
涉及到多个状态 首先画出状态图

![Image](~/../../static/img/1.png)
我们控制其中三个状态
- 天数
- 购买次数
- 当前股票状态（0为未持有；1为持有）

以无限次购买股票为例
```java
    int n = prices.length;
    int dp_0 = 0;
    int dp_1 = Integer.MIN_VALUE;

    for (int i = 0; i < n; i++) {
        dp_0 = Math.max(dp_0, dp_1 + prices[i]);
        dp_1 = Math.max(dp_1, dp_0 - prices[i]);
    }

    return dp_0;

/**
执行用时 :3 ms, 在所有 Java 提交中击败了10.65%的用户
内存消耗 :42.3 MB, 在所有 Java 提交中击败了5.01%的用户
本题可以不必使用DP以达到更快的速度
*/
```
该例中由于无限次购买可以省略购买次数  
dp_0的含义为：当前未持有股票  
其只能由dp_0保持不变或dp_1出售得来选取最大值  

其中base case（最简单的情况）的赋值：
- 一开始未持有的状态为0；
- 一开始持有的状态不可能存在故赋值最小值  

在该题中
```java
    int n = prices.length;
    int dp_2_0 = 0;
    int dp_2_1 = Integer.MIN_VALUE;
    int dp_1_0 = 0;
    int dp_1_1 = Integer.MIN_VALUE;

    for (int i = 0; i < n; i++) {
        dp_1_1 = Math.max(dp_1_1, - prices[i]);     // !!! - prices[i]
        dp_1_0 = Math.max(dp_1_0, dp_1_1 + prices[i]);
        dp_2_1 = Math.max(dp_2_1, dp_1_0 - prices[i]);
        dp_2_0 = Math.max(dp_2_0, dp_2_1 + prices[i]);
        
    }
    
    return dp_2_0;

/**
执行用时 :3 ms, 在所有 Java 提交中击败了82.59%的用户
内存消耗 :41.9 MB, 在所有 Java 提交中击败了23.33%的用户
*/
````
由于是第二次售出

**注意**
- **第一次直接持有的状态只能是购入股票故其只能从`(dp_1_1, - prices[i])`中选取最大值**
- **第二次持有因为状态转移只能从第一次未持有转移来故其从`(dp_2_1, dp_1_0)`中选取最大值**

base case（最简单的情况）的赋值：  
- 第一次未持有的状态金额肯定为0；  
- 第一次持有的状态不存在故赋值`MIN_VALUE`；  
- 第二次未持有的状态赋值0；  
- 第二次持有的状态因为不可能直接持有故赋值`MIN_VALUE`  


> Reference  
> https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-ii  
> https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-iii
